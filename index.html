<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Конфигуратор</title>
  <style>
    body{margin:0;background:#000;display:flex;justify-content:center;align-items:center;flex-direction:column;font-family:system-ui}
    .stage{position:relative;width:100%;max-width:1280px;aspect-ratio:16/9;background:#000;overflow:hidden}
    .layer{position:absolute;inset:0}
    .layer img{width:100%;height:100%;object-fit:cover;display:block}
    .controls{position:absolute;bottom:10px;left:0;right:0;display:flex;justify-content:center;align-items:center;flex-wrap:wrap;gap:10px;background:none;padding:4px}
    .view-controls{display:flex;gap:6px;margin-right:10px;flex-wrap:wrap;justify-content:center}
    .view-controls button{padding:4px 8px;background:none;border:1px solid #fff;border-radius:4px;color:#fff;cursor:pointer;text-shadow:0 0 2px #000;font-size:13px}
    .view-controls button.active{background:rgba(255,255,255,0.1)}
    .block{display:flex;align-items:center;gap:6px;color:#fff;text-shadow:0 0 2px #000;flex-wrap:wrap;justify-content:center;font-size:13px}
    .thumbs{display:flex;gap:4px;flex-wrap:wrap;justify-content:center}
    .thumb{width:28px;height:28px;border-radius:4px;border:1px solid #fff;cursor:pointer}
    .thumb.active{outline:2px solid #fff;transform:scale(1.05)}
    .slider-block{display:flex;align-items:center;gap:4px;color:#fff;text-shadow:0 0 2px #000;font-size:12px}
    input[type="range"]{width:70px;cursor:pointer}

    @media (max-width:768px){
      .controls{gap:6px;bottom:4px;padding:2px}
      .view-controls button{font-size:11px;padding:3px 6px}
      .thumb{width:24px;height:24px}
      input[type="range"]{width:60px}
    }
  </style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="layer" id="baseLayer"></div>
    <div class="layer" id="wallsLayer"></div>
    <div class="layer" id="sillLayer"></div>
    <div class="layer" id="ceilingLayer"></div>
    <div class="layer" id="tablesLayer"></div>
    <div class="controls" id="controls">
      <div class="view-controls" id="viewControls"></div>
      <div class="block"><span>Стены</span><div class="thumbs" id="wallsThumbs"></div></div>
      <div class="block"><span>Подоконник</span><div class="thumbs" id="sillThumbs"></div></div>
      <div class="block"><span>Потолок</span><div class="thumbs" id="ceilingThumbs"></div></div>
      <div class="block"><span>Столы</span>
        <!-- убрал лишнюю кнопку/мини-цветы для столов — теперь управление только ползунком -->
        <div class="slider-block"><span>0</span><input type="range" id="tablesOpacity" min="0" max="100" value="100"/><span>100</span></div>
      </div>
    </div>
  </div>

<script>
(function(){
  const views=['view1','view2','view3','view4'];
  let currentView=0;
  const basePattern='base_beige_#.jpg';
  const options={
    walls:[
      {file:'walls_white_#.png',color:'#fff'},
      {file:'walls_choco_#.png',color:'#5a3c2a'},
      {file:'walls_blue_#.png',color:'#8ab7e3'},
      {file:'walls_malachite_#.png',color:'#0b7d5c'},
      {file:'walls_beige_#.png',color:'#d8c39f'}
    ],
    sill:[
      {file:'sill_white_#.png',color:'#fff'},
      {file:'sill_choco_#.png',color:'#5a3c2a'},
      {file:'sill_blue_#.png',color:'#8ab7e3'},
      {file:'sill_malachite_#.png',color:'#0b7d5c'},
      {file:'sill_beige_#.png',color:'#d8c39f'}
    ],
    ceiling:[
      {file:'ceiling_white_#.png',color:'#fff'},
      {file:'ceiling_choco_#.png',color:'#5a3c2a'},
      {file:'ceiling_blue_#.png',color:'#8ab7e3'},
      {file:'ceiling_malachite_#.png',color:'#0b7d5c'},
      {file:'ceiling_beige_#.png',color:'#d8c39f'}
    ],
    // файл мебели (столов/стульев) — должен быть один PNG с прозрачностью по ракурсам: tables_set_view1.png и пр.
    tables:[{file:'tables_set_#.png',color:'#c9a96e'}]
  };

  // состояние: теперь tables по умолчанию включены (чтобы картинка сразу показывалась)
  const state={walls:'',sill:'',ceiling:'',tables: options.tables[0].file};

  const baseEl=document.getElementById('baseLayer');
  const layersMap={walls:document.getElementById('wallsLayer'),sill:document.getElementById('sillLayer'),ceiling:document.getElementById('ceilingLayer'),tables:document.getElementById('tablesLayer')};
  const opacitySlider=document.getElementById('tablesOpacity');

  function preloadImage(src){
    return new Promise(r=>{if(!src){r(null);return;}const i=new Image();i.onload=()=>r(i);i.onerror=()=>r(null);i.src=src;});
  }
  function makeName(p){return p.replace('#',views[currentView]);}

  async function drawBase(){
    baseEl.innerHTML='';
    const img=await preloadImage(makeName(basePattern));
    if(img)baseEl.appendChild(img);
  }
  async function drawLayer(layer){
    const el=layersMap[layer];
    el.innerHTML='';
    const pattern=state[layer];
    if(!pattern) return;
    const img=await preloadImage(makeName(pattern));
    if(img){
      if(layer==='tables') img.style.opacity = (opacitySlider.value/100).toString();
      el.appendChild(img);
    }
  }

  // создаём мини-кнопки только для real color layers (без столов)
  function setupThumbs(){
    ['walls','sill','ceiling'].forEach(layer=>{
      const c=document.getElementById(layer+'Thumbs');
      c.innerHTML='';
      options[layer].forEach(opt=>{
        const d=document.createElement('div');
        d.className='thumb'; d.style.background=opt.color;
        d.onclick=()=>{ state[layer]=opt.file; document.querySelectorAll('#'+layer+'Thumbs .thumb').forEach(t=>t.classList.remove('active')); d.classList.add('active'); drawLayer(layer); };
        c.appendChild(d);
      });
    });
  }

  async function changeView(i){
    currentView=i;
    document.querySelectorAll('.view-controls button').forEach((b,n)=>b.classList.toggle('active',n===i));
    await drawBase();
    await Promise.all(['walls','sill','ceiling','tables'].map(k=>drawLayer(k)));
  }

  opacitySlider.oninput = ()=>{ const img = layersMap.tables.querySelector('img'); if(img) img.style.opacity = opacitySlider.value/100; };

  // создать кнопки ракурсов
  const vc=document.getElementById('viewControls');
  views.forEach((v,i)=>{const b=document.createElement('button');b.textContent='Ракурс '+(i+1);b.onclick=()=>changeView(i);vc.appendChild(b);});

  setupThumbs();
  changeView(0);

})();
</script>
</body>
</html>
